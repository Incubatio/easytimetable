{% extends "agenda/base_fullcalendar.html" %}
{% load i18n %}
{% block fullcalendar_init %}
<script type="text/javascript"> 
calendar = null;


$(document).ready(function(){
    
    var calendar = $('#calendar').fullCalendar({
        header: {
            left: 'prev,next today',
            center: 'title',
            right: 'month,agendaWeek,agendaDay',
        },
        selectable: true,
        selectHelper: true,
        editable: true,
        select: function(start, end, allDay) {
           pop_add_event_dialog(start, end, allDay); 
        },
        eventClick: function(calEvent, jsEvent, view) {
            alert('clicked');
        },
        eventDrop: function(calEvent, delta) {
            alert('dropped');
        }
    });

    // automatically load ajax links within a modal dialog box
    $('a.ajax').click(function(){return pop_add_event_dialog(null,null,null);});
    
    $('#cals_to_show>:checkbox').each(function(){
        $(this).click(function(){
            var action;
            if (this.checked == true)
                action = "add";
            else
                action = "remove";
            
            $('#calendar').fullCalendar(action + 'EventSource', "{% url agenda:get_planning %}"+
                this.value);
        });
        $(this).click();
    });
});

function pop_add_event_dialog(start, end, allDay)
{
    $("#form_add_user_event").dialog()
    //prevent the browser to follow the link
    return false;
}
</script>
{% endblock %}
{% block content %}
<h2>Calendar</h2>
<div id='calendar'></div> 
{% endblock %}
{% block menu %}
<ul>
    <li><a class="ajax" href="{% url agenda:add_user_event %}" />{% trans "Add user event" %}</a></li>
</ul>
<form id="cals_to_show">
<input type="checkbox" name="what" value="me">
{% trans "My Calendar" %}<br />
<input type="checkbox" name="what" value="classgroup">
{% trans "My Class Calendar" %}<br />
<input type="checkbox" name="what" value="campus">
{% trans "My Campus Calendar" %}<br />
<input type="checkbox" name="what" value="university">
{% trans "My University Calendar" %}<br />
</form>

<div id="add_user_event">
<form id="form_add_user_event">
   {{user_form.as_p}}
   <button>{% trans "create" %}</button>
</form>
</div>
{% endblock %}
